{# The following variables are available to all scripts. #}
{% if overview or detailed %}
{% set field_operation = "%s %s" %}
{% set ns = namespace(field_parameters='', dash='') %}
{% endif %}
{% if detailed %}
{% if parameters %}
{% for para in parameters %}
{% set ns.dash = ns.dash + '- | ' %}
{% set ns.field_parameters = ns.field_parameters + '%s | ' %}
{% endfor %}
{% set para_head = ns.field_parameters | format(*parameters) %}
{% endif %}
{% endif %}

{% block overview %}
{% if overview %}
{{ 'Overview: \n' }}
{{ 'Total # of jobs: %s ' | format(jobs | length) }}

{% block progress %}
| label | ratio |
| ----- | ----- |
{% for label in progress_sorted %}
| {{ label[0] }} | {{ label[1]|draw_progressbar(jobs | length, '\\') }} |
{% endfor %}
{% endblock%}

{% block aggregate_summary %}
| operation | number of eligible aggregates |
| --------- | ----------------------------- |
{% for ops, n_aggs in aggregate_counter %}
| {{ ops }} | {{ n_aggs }} |
{% endfor %}
{% endblock %}
{% endif %}
{{ 'All operations are now aggregate operations hence you will '
   'now see number of eligible aggregates instead of eligible jobs.'
}}
{% endblock%}

{% block detailed %}
{% if detailed %}
{{ 'Detailed View: \n' }}
| job_id | operation | {{ para_head }}labels |
| ------ | --------- | {{ ns.dash }}-------- |
{% for job in jobs %}
{% if parameters %}
{% set para_output = ns.field_parameters | format(*job['parameters'].values()) %}
{% endif %}
{% for key, value in job['operations'].items() if value | job_filter(scheduler_status_code, all_ops) %}
{% if loop.first %}
| {{job['job_id']}} | {{ field_operation | highlight(value['eligible'], pretty) | format(key, '['+scheduler_status_code[value['scheduler_status']]+']') }} | {{ para_output }}{{ job['labels'] | join(', ') }} |
{% else %}
|  | {{ field_operation | highlight(value['eligible'], pretty) | format(key, '['+scheduler_status_code[value['scheduler_status']]+']') }} | {{ para_output }}{{ job['labels'] | join(', ') }} |
{% endif %}
{% endfor %}
{% endfor %}

{{ 'Detailed Aggregate View: \n' }}
| operation | aggregate |
| --------- | --------- |
{% for op, agg_stati in detailed_ags.items() %}
{% for agg, stati in agg_stati %}
{% if loop.first %}
| {{op}} | {{agg }}| {{'['+scheduler_status_code[stati]+']' }} |
{% else %}
|  | {{ agg }} | {{ '['+scheduler_status_code[stati]+']' }}|
{% endif %}
{% endfor %}
{% endfor %}
{{ status_legend }}
{% endif %}
{% endblock %}
